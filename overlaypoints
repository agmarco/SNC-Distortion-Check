#!/usr/bin/env python
import sys

import dicom
import scipy.io
import matplotlib.pylab as plt
import numpy as np

from dicom_import import combine_slices
from affine import apply_affine
from overlaypoints import overlay_points


if __name__ == '__main__':
    if len(sys.argv) <= 3:
        print('Usage: overlaypoints DICOMFILES... POINTFILE')
        sys.exit(1)

    input_dicom_filenames = sys.argv[1:-1]
    dicom_datasets = [dicom.read_file(f) for f in input_dicom_filenames]

    voxels, ijk_to_xyz_transform = combine_slices(dicom_datasets)

    points_filename = sys.argv[-1]
    points_xyz = scipy.io.loadmat(points_filename)['points']

    descriptors = [{'points_xyz': points_xyz, 'scatter': {'color': 'r'}}]
    overlay_points(voxels, ijk_to_xyz_transform, descriptors)
